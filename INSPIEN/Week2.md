# Week 2 : OS(Ubuntu) 기타

**모르는 사람이 봐도 이해할 수 있게 - 나부터 바로 이해되도록**

## 리눅스의 종류  
- 리눅스가 무엇인가?  
리누스가 만든 UNIX라는 뜻의 운영체재  
리누스는 프로세스 관리, 파일 시스템 관리, 메모리 관리를 담당하는 커널을 만들었고, 리눅스의 발전을 지원하는 GNU프로젝트를 통해 응용프로그램이 더해져 지금의 모습이 되었다.  

- 리눅스는 종류가 왜 많은가?  
리눅스의 특징은 누구나 자유롭게 사용할 수 있다는 점이다.  
이러한 특징 아래에서 용도에 맞는 다양한 변형생기다보니 2013년 기준으로만 450개의 배포판이 존재한다.  
    - 단적인 예  
    RHEL은 주로 기업용으로 쓰이고, 우분투는 개인용으로 쓰이며  
    해킹, 디지털 포랜식에 주로 사용되는 칼리 리눅스나  
    라우터, 방화벽, VPN 용도에 최적화된 알파인 리눅스등  
    다양한 용도에 특화된 리눅스도 존재한다.

- 리눅스는 크게 세가지 계열로 구분할 수 있으며 특징은 다음과 같다.

1. 슬랙웨어 계열  
배포판 중 가장 오래되었다.  
패키지 매니저를 사용하지 않아서 사용자가 모든 작업을 알아서 관리해야한다.  
특징적으로는 의존성 검사를 하지 않는다.  
사용자의 자유도가 높은 만큼 책임도 커서 사용률이 높지는 않다.  
    - SuSE  
    유럽에서 많이 사용되는 데스크탑과 서버용 리눅스  
    SAP와의 협업으로 SAP 솔루션에서 높은 점유율을 가진다.

2. 레드햇 계열  
레드햇 이라는 기업에서 제공하는 배포판으로 가장 큰 특징은 기업에서 해주는 기술지원이다.  

기술지원을 통한 안정성 덕에 서버용도로 잘 쓰인다.  
RedHatEnterpriseLinux가 대표적인 배포판이며 시장 점유율이 가장 높다.

    - CentOS  
    레드햇에서 유료로 제공하는 배포판의 소스코드를 사용해서  
    무료로 사용할 수 있도록 똑같이 만든 배포판  
    유료로 제공되는 안정성 높은 배포판을 무료로 사용할 수 있다는 장점이 있다. 단점으로는 기술 지원이 불가능하다.  
    얼마전부터 지원이 종료되어 다른 클론 프로젝트가 진행중이다.  
    - Fedora  
    레드햇에서 제공하는 테스트 목적의 배포판  
    레드햇의 새로운 기능을 페도라에서 무료로 제공하여 테스트를 하고 해당 테스트를 바탕으로 안정화된 버전을 유료로 배포하는 방식이다.  

3. 데비안 계열  
적극적으로 비 자유 소프트웨어를 배제하는 배포판이다.  
대표적인 배포판으로 우분투가 존재하며 기업 혹은 재단과 같은 주체가 주도하는 것이 아닌데다가 안정성을 우선시해서 다른 배포판들에 비해 업데이트가 보수적으로 이루어진다.
    - Ubuntu  
    6개월 단위로 새 버전을 발표하며, 2년 주기로 LTS(5년 기술지원 버전)을 발표한다.  
        - 편리한 점  
        데비안이 사용하는 apt를 이어받아 패키지를 쉽게 관리할 수 있다.  
        이 때문에 일반 사용자들이 많이 사용한다.  
        여러 하드웨어가 필요로 하는 펌웨어나 드라이버를 미리 탑재하고 있어서 하드웨어 인식도 편리하다.  
        사용자가 많아서 관련 자료도 풍부하다.

4. 종류 별 차이  
라이브러리, 설정 파일, 패키지 설치 방법과 관련해서 차이가 난다.  
    - 패키지란  
    리눅스 소프트웨어를 실행하는데 필요한 파일들이 담겨있는 설치 파일 묶음  
    - 저수준 툴 : dpkg, rpm 등 실제 패키지의 설치, 업데이트, 삭제를 수행
    - 고수준 툴 : apt, yum 등 의존성 해결, 패키지 검색등의 기능 제공
        - 예를들어 dpkg는 해당 패키지만 설치하기 때문에  
        해당 패키지에 종속되어 설치되어야 하는 프로그램을 함께 설치하려면 apt를 사용해야한다. 인터넷이 연결되어있다면 자동으로 설치되고 폐쇄망이라면 로컬 리포지토리를 구성해서 경로를 설정해야한다.

- 목적에 따른 사용 빈도 추가
    - 기업은 RHEL 혹은 CentOS 사용(2020년 CentOS 지원 종료를 발표하면서 대체제로 Rocky Linux나 우분투가 떠오르고 있다.)  
    CentOS는 레드햇 기업에서 배포하는 RHEL를 기반으로 하는 만큼 패치가 보수적이고 안정적이다.  
    - 개인용으로는 우분투가 편리하다
    - CentOS와 RHEL이 기업용으로 인기인 만큼 해당 배포판에만 설치가 가능한 프로그램도 존재했다.

## 리소스 모니터링
- 리소스 모니터링이 무엇인가?  
리소스의 상태 변화를 지속적으로 감시하는 과정이다.  
일반적으로 CPU, Memory, I/O를 관찰한다.  
cpu는 실질적인 작업 처리, 메모리는 cpu에서 처리할 데이터를 임시로 보관하고, 입출력 장치를 통해 반영구저장장치에서 메모리로 데이터를 전송한다.  
- 어떻게 하는가?
    - CPU 문제 점검  
        - top, htop : 실시간 CPU, Memory 모니터링 가능  
        CPU나 메모리를 많이 사용하는 프로세스를 찾는다.  
        - top 설명 : https://sabarada.tistory.com/146
            - cpu는 cpu%나 load average  
            - load average :  
            수행되고 있거나 실행 가능한 상태, 혹은 입출력에 대해 대기하고있는 상태에 있는 프로세스들의 개수를 1,5,15 분 단위로 평균값을 낸 것  
                - 높다면 : 많은 프로세스가 실행중이며 실행 대기중이라는 것.  
                - 1분값이 15분 값에 비해 작다면 장애가 발생한지 조금 지났다는 뜻
                - 15분 값보다 1분값이 크다면 현재 부하가 높아지고있다는 것
                - 주의해야할 것  
                수행되고 있는 프로세스 혹은 응답 대기중인 상태 두가지를 계산하고있기때문에 둘 중 어느 프로세스의 비중이 큰지를 판단해야한다.  
                    - vmstat 명령을 사용하면 확인 가능  
                    r이 높으면 실행중인게 많다 -> CPU 리소스 부하  
                    b가 높으면 대기중인게 많다 -> I/O 부하  
                    (https://brunch.co.kr/@dreaminz/1)
            - **CPU 상태에 대해 ppt에만 따로 정리**
        - cpu 체크사항 :  
            - 전체, 프로세스별 cpu 사용률 -> 어떤때 어느 프로세스에서 많이 사용하는가
            - i/o wait -> 디스크 읽기/쓰기 완료시 까지 cpu가 대기하는 시간이며 이것이 높으면 메모리 혹은 디스크에 문제가 있음을 의심할 수 있다. 
    - 메모리 문제 점검  
        - free  
            - 전체 메모리 total
            - 실제 free 메모리 : free + buffers + cached
            - 실제 메모리 사용량 : total - 실제 free 메모리
        - cache, buffer  
            - cache : 빠르게 실행하기 위해서 '파일의 내용을' 메모리에 미리 저장해두는 것.  자주 사용하는 것은 성능에 도움이 되지만 자주 사용하지않는 것이 있으면 공간만 차지해서 메모리 낭비가된다.
            - buffer : 파일의 내용이 아닌 '파일에 대한 정보'를 저장한다.  
        - 자세한 정보 -> /proc/meminfo

        - swap 메모리 : 실제 메모리가 가득 찼을때 하드디스크공간을 활용해서 메모리로 사용하는 것  
        buffer,cache 영역을 전부 반환했음에도 부족한 경우 사용된다.
        
    - 디스크 문제 점검  
        cpu나 메모리에 비해 느리기 때문에 더욱 성능 향상을 기대할 수 있는 부분이다.  
        - vmstat(https://lilo.tistory.com/33)  
            - r : CPU에서 대기중인 프로세스의 수, 높다면 CPU의 성능 개선필요
            - b : 입출력 자원을 할당받지 못해서 sleep 상태인 프로세스의 수, 높다면 디스크 i/o를 확인해봐야한다.
            - si : 디스크 swap 공간에 있는 데이터를 메모리로 호출하는 양
            - so : 메모리에서 디스크로 보내는 데이터 양이며, 지속적으로 발생한다면 메모리가 부족하다는 뜻이다.
            - io : 입출력 상태를 나타내며 해당값이 높다는 것은 디스크에 읽고 쓰는 값이 많다는 뜻이다.
        - iostat(디스크 입출력 통계)  
            - 입출력 대기시간 혹은 처리시간을 확인할 수 있다.  
            - 디스크 활동이 고루 분산되어있는지 확인  
            - 대책  
            : 가능한한 i/o작업 분산  
            버퍼/캐쉬를 늘리기  


- 해야하는 이유
    - 문제가 발생했을때 빠르게 원인을 파악할 수 있는 수단이된다.

    - 평소에도 모니터링을 해서 평소 상태와 비교함으로써 어떤 상황에 성능에 영향이 생기는지 미리 알 수 있다.  

    - 과거와 현재의 사용량을 알고있으면 앞으로의 용량을 계획하는데 중요한 지표가 된다. 


## 심볼릭 링크
- 심볼릭 링크가 무엇인가?  
    - 하드링크  
    원본 파일과 동일한 내용의 다른 파일  
        - 복사와 다른점 : 하드링크 파일을 수정하면 원본 파일도 변경된다.
        - inode : 리눅스 파일의 권한, 종류, 크기, 수정시간 등 파일에 관한 다양한 정보를 가지고 있는 임의의 번호다. 파일명이 다르더라도 이 번호가 같다면 같은 파일로 인식된다. 하드링크는 inode번호가 동일하고 복사본은 다르다.  
    - 소프트 링크(심볼릭 링크)
        - 윈도우의 바로가기와 유사하다.  
        - 원본 파일과 다른 inode를 가지는 다른 파일이지만 원본 파일을 가리켜서 원본 파일과 연결하는 효과를 가진다.
        - 즉 원본파일의 위치에 직접 가지 않아도 원본파일을 실행할 수 있다.  
        - 원본 파일이 삭제되면 실행할 수 없고  
        원본 파일이 대체되면 대체된 파일을 실행한다.
- **심볼릭 링크 생성,삭제 실습**
- 심볼릭 링크는 어디에 필요한가?(심볼릭 링크 사용 이유)
    1. 경로 단축  
    2. 효율적인 관리  
    파일의 성격이 같은것끼리 두고싶을때, 경로가 다르면 관리하기 어렵다  
    심볼릭 링크를 사용하면 한 디렉터리에 같은 성격의 파일들을 모아둘수있다.  

## 서비스와 스케쥴링
- 서비스(프로세스)란 무엇인가?  
파일 실행 주체  
파일을 실행했을때 CPU에 올라가서 실행되는 하나의 인스턴스  
문서 파일을 실행한것은 하나의 파일을 실행한 것이지만
문서 파일을 실행하고 인쇄를 하면 파일을 열고, 문서를 인쇄하는 두가지 프로세스가 진행되는 것이다.

- 스케쥴링은 무엇인가(crontab, initd)?  
프로세스 실행 순서를 정하는 것  
    - cron : 특정한 시간, 혹은 시간 마다 특정 작업을 반복적, 자동으로 수행하고 싶을때 사용하는 데몬  
    - 데몬이란?  
    : 백그라운드에서 동작하며 특정한 서비스를 제공하는 프로세스.  
    대표적으로 프로그램을 자동을 실행하는 cron과 로그를 작성하는 syslogd가 있다.  
    백그라운드에서 계속 동작중이기 때문에 매 상황에 대한 로그를 기록할 수 있는 것이다.

- 스케쥴링은 왜 필요한가?  
    - 보안 검사나 데이터 전송 등 정기적으로 실행할 필요가 있는 작업이 있을때 필요하다.  
    - 시스템 사용이 적은 시간에 작업량이 많은 작업을 수행해야할때 시간을 설정해서 자동으로 수행할 수 있다.  
- cron 실행 과정
    - (/etc/crontab)crontab : cron 작업을 설정하는 파일.  
    - 전원 ON -> (바이오스[하드웨어 상태를 확인한 후 부팅 디스크 로딩]부트 로더[운영체제 로딩], 커널 초기화) -> system 데몬 -> cron 데몬  
    -> crontab을 읽어 해당 작업 실행  
    -> /var/spool/cron 내의 파일(각 사용자의 개별 cron설정 파일)을 읽음  
    -> cron에 의해 수행되지 모산 작업 anacron에서 수행 시도  
    -> cron 로그 파일에 실행 기록
    - system 데몬 : 시스템 부팅후 가장 먼저 실행되는 데몬이며 부팅 뿐만 아니라 서비스, 로그등 다양한 설정을 관리한다.  
    기존에 사용하던 init 방식과 달리 병렬로 실행해서 부팅 속도가 빠르다.
- **cron 실습**

## 서비스와 권한
- 서비스 권한이란 무엇인가?  
    - 파일에 따라 읽고, 쓰고, 실행할 수 있는 권한을 설정할 수 있다.
- 권한은 왜 필요한가?
    - 리눅스는 여러 사용자가 함께 사용할 수 있는 운영체제이기 때문에 다른 사용자가 파일을 함부로 수정,삭제,실행할 수 없도록 관리하는 것이 중요하다.  
    - 리눅스에는 소유권과 허가권이 존재한다.  
    소유권은 어떠한 파일이나 디렉터리를 소유해서 지배하는 권리이고  
    허가권은 해당 파일에 접근 권한을 설정하는 권리이다.  
    일반적으로 소유권을 가진 사용자가 허가권을 설정한다.  

- 권한 설정 방법(접근 허가권)  
    - -rwxrwxrwx : 3개씩 끊어서 소유권자/그룹사용자/그외사용자 의 권한을 나타낸다.  
        - r : read
        - w : write
        - x : execute
    - chmod(change mod)  
        - u,g,o,a(각 사용자)
        - +,-,=(권한 연산자)
        - rwx(권한)
        - -R : 하위파일 권한 설정
- 소유권 변경(루트 사용자만 가능)
    - chown(change owner)  
        - chown [option] owner[:group] file(s)  
- **권한설정 실습과 관련 예외들**

## 커널 모듈
- 커널이란?  
프로세스 관리, 메모리 관리, 파일 시스템 관리, 장치 관리 등 컴퓨터의 모든 자원을 초기화하고 제어하는 리눅스의 핵심  
    - 모놀리식 커널  
    리눅스에서 사용하는 커널 방식이며 시스템을 제어하는 기능이 내장되어 하나의 형태로 구성되어있다.  
    이러한 방식은 각 기능간 커뮤니테이션이 좋고, 시스템 호출에 의한 서비스가 빠르다는 장점이 있지만 기능을 변경하거나 새로운 장치를 추가하는 등 커널에 변경이 필요하면 커널을 재빌드해야한다.  
    이러한 단점을 극복할 수 있는 기능이 커널 모듈이다.  
    - 마이크로식 커널  
    핵심적인 기능만 커널로 구성되고 이외의 기능은 프로세스로 사용되어 추가나 수정이 편리한 방식  
    모놀리식에 비해 비교적 시스템 복잡성이 높고 성능이 저하될 수 있다.
- 커널 모듈이란?  
리눅스의 핵심인 커널에 어떤 기능을 추가하려면 커널 재부팅이 필요하다.  
모듈을 사용하면 시스템이 실행중인 상황에서 동적으로 기능을 추가하거나 제거할 수 있다.  

- **윈도우와 비교하여 커널 설명**
    - 윈도우의 경우 새로운 그래픽 카드를 장착했을때, 윈도우 실행 후, 해당 그래픽 카드의 장치 드라이버를 인터넷에서 찾아서 실행하면 그래픽 드라이버가 제대로 인식되고 동작한다.  
    - 리눅스는 모놀리식 커널이라 장치 드라이버도 커널 공간안에 존재하기 때문에 새로운 장치가 추가되면 커널 자체를 수정하고 다시 컴파일해야한다.  
    - 이러한 번거로움을 해결해 주는것이 커널 모듈이다.  
    커널 모듈은 요청시에 커널에 기능을 로드해주기 때문에 커널 전체를 다시 빌드하고 재부팅 할 필요가 없다.  
    (https://hoohaha.tistory.com/80) 자료 
    

## syslog 데몬
- syslog 데몬은 무엇인가  
시스템 내의 수많은 커널 경고, 디버깅 정보, 메세지 등 여러가지 로그 정보를 기록하는 데몬  

- 동작 흐름
    1. 시스템이 부팅되면서 syslogd 실행
    2. syslog.conf를 읽어서 로그파일에 관한 설정 반영
    3. syslog.conf에 기록된 각각의 로그파일들의 로그기록 시작
    4. logrotate에 의해 각 log파일들 관리
        - logrotate란?  
        계속 쌓이는 로그가 너무 거대해지지 않도록 주기적으로 삭제하는 서비스  
- 로그 종류
    - facility : 메시지가 어디에서 왔는지  
        - auth : 로그인 등 사용자 인증 관련
        - cron : cron 데몬에 의해 발생되는 스케쥴링 관련
        - daemon : 데몬 관련
        - kern : 커널에 의한 메세지
        - mail : mail, pop 등 메일 관련
        - user : 사용자에 의해 생성된 프로세스
        - syslog : syslogd에 의해 발생되는 모든 메시지
    - priority : 메세지의 성격(정도)  
        - debug : 디버깅 관련
        - info : 단순 정보
        - notice : 알림
        - warning : 경고
        - err : 에러
        - crit : 치명적인 문제 발생
        - alert : 즉각적인 조치 필요
        - emerg : 가장 최상위인 긴급한 상황
    - 액션 : 어디로 출력할지  

- 로그 로테이션
    - 로그 파일은 시간이 지날수록 데이터가 쌓이고 거대해진다.  
    - 로그 로테이션 기능을 사용하면 얼마 주기로 새로운 로그 파일을 생성하고, 백업 로그를 얼마동안 보관할 것인지를 설정 가능하다.  
    - 이 역시 cron에 등록되어 실행된다.

- 로깅의 필요성
    - 로깅은 당연히 중요
    - 상황에 따른 적절한 메세지를 기록하는 것이 중요하다.
-----------------------------------

***********************************
**설명에서 모르는 단어는 없어야한다.**
***********************************

-----------------------------------