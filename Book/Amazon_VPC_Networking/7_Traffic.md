# 컴퓨팅 서비스의 네트워킹 요건

## 트래픽의 시작 : IP 주소
- IP의 유형은 공인public/비공인private 와 정적static/동적dynamic 으로 나뉜다.  
    - 공인 IP와 비공인 IP를 결정하는 것은 KT,SKT와 같은 ISP(Internet Service Provider)다.  
    AWS를 예로들면, AWS는 ISP에게 일정 비용을 지불해서 IP를 할당 받음으로써 외부에서 접근할 수 있는 주소를 만든다.  
    만약 ISP에게 IP를 할당받지않고 AWS와 똑같은 IP를 사용하면 중복이 없는 한 내부 네트워크 에서는 사용이 가능하겠지만 외부에서는 접근할 수 없다.  
    이러한 IP를 비공인 IP라고 한다.  
        - 그렇다면 내부 네트워크의 사용자가 위에서 설정한 똑같은 ip로 접근하려고 시도하면 어디로 이동할까?  
        우선 내부 네트워크에서 설정한 곳으로 이동할 것이다. 즉 aws로는 이동할 수 없다.  
        이를 제어하는 방법은 있지만 그렇게되면 내부 네트워크에 접근할 수 없게 된다.  
        따라서 ip는 신중하게 결정해야하는 것이다.

    - 정적 IP는 말 그대로 고정되어 변하지 않는 IP이며 주로 서비스용 IP에서 사용한다.  
    주기적으로 IP가 변경되는 동적 IP는 네트워크 인터페이스에서 변경된다.

- AWS의 IP 분류  
위에서 나눈 분류를 바탕으로 AWS에서는 4가지 유형으로 ip를 나눌 수 있다.
    - 정적인 공인 IP : 탄력적 IP
        - 리전에 종속된 네트워킹 리소스며 탄력적 IP 자체만으로는 아무것도 할 수 없다.
        - 인스턴스, NAT 게이트웨이, 로드밸런서에 탄력적 IP를 연결할 수 있는데, 이 리소스들이 네트워크 인터페이스를 장착하고 있기 때문이다.  
        - 즉 탄력적 IP는 네트워크 인터페이스의 프라이빗 IP에 연결된다.
        - 아래의 퍼블릭 IP도 Amazon IPv4 주소 풀에서 할당받지만 리소스에 직접 할당되어 계정이 소유하지는 못한다.
    - 정적인 비공인 IP : 기본 프라이빗 IP, 보조 프라이빗 IP
    - 동적인 공인 IP : 퍼블릭 IP





---

## 트래픽 전달의 주체 : 탄력적 네트워크 인터페이스(ENI)
- VPC 네트워킹의 중심 리소스로 일반적으로 네트워크 인터페이스 로 불린다. VPC 네트워킹은 반드시 ENI를 기반으로 한다.
- 온프레미스 환경의 NIC(Network Interface Card)에 상응하는 가상 장치이며  
인스턴스가 만들어 낸 트래픽을 네트워크로 전송하거나 네트워크에서 들어온 트래픽을 수신한다.  
- 개별 생성이 가능하지만 VPC 서비스에 연결되지 않은 상태로는(트래픽 전달을 지시할 서비스가 없으면) 아무 기능도 할 수 없다.
- 네트워크 인터페이스는 서브넷에 생성하기 때문에 최소 1개의 프라이빗 IP를 소유한다.  

### ENI의 두가지 유형
- **A 데이터 처리**  
    - 인스턴스, RDS, Lamda, EFS 등이 속한다.
    - 이들은 애플리케이션 실행, 컴퓨팅, 스토리지 등 **데이터 가공이나 저장이 주된 역할**이며 ENI는 트래픽 전송수단에 불과하다. 
    - 소스/대상 확인(출발,도착시 IP 확인)을 하는 것이 기본 값이다.
    - 데이터를 처리해야하므로 보안 그룹을 통해 보호해야한다.  
        - 네트워크 인터페이스가 있다는 말은 그를 위한 보안 그룹이 존재한다는 뜻이다.
        - 그리고 네트워크 인터페이스가 존재하기 위해서는 서브넷이 필요하고, 서브넷이 존재하려면 VPC가 필요하다.

- **B 트래픽 전송**
    - NAT 게이트웨이, 전송 게이트웨이 같은 네트워크 디바이스
    - 트래픽 전송이 주 목적이다. 경로를 제어하긴 하지만 데이터 내용을 변경, 가공하지는 않는다.
    - 소스/대상 확인을 하지 않는 것이 기본값이며 확인 하도록 설정할 수도 없다.  
    NAT 게이트웨이의 경우, 프라이빗 IP에서 퍼블릭 IP로 패킷을 전달하므로 두가지 IP를 모두 소유해야하기 떄문이다.
    - 트래픽을 허용/차단할 수단으로 네트워크 ACL을 사용할 수 있다. 


---

## 트래픽 생성의 주체 : EC2 인스턴스
EC2(Elastic Compute Cloud)는 가상 서버다.  
모든 종류의 운영체제를 다양한 설정으로 제공하는데 이것을 가능하게 하는 것이 AMI(Amazon Machine Image)다.  
- 인스턴스의 조건
    - 인스턴스를 생성하면서 자동으로 생성되는 네트워크 인터페이스는 분리할 수 없다.
    - 인스턴스에는 최소 1개 이상의 ENI가 연결되어 있다. 0개일 수 없는 이유는 위와 같다.
    - ENI는 서브넷에 생성된다.
        - 서브넷에 놓이려면 최소 1개 이상의 프라이빗 IP가 연결돼야 한다.
        - 서브넷은 가용 영역과 VPC의 교집합 영역에 놓인다.
        - 가용 영역과 VPC는 리전에 생성된다.
        - 즉 **인스턴스는 가용영역과 VPC의 교집합 영역에 있어야한다.**