# 실무와 같은 배포

### SNS의 이미지 처리 아키텍쳐

- 해당 아키텍처를 고른 이유
- 대부분 SNS라는 도메인을 잘 알고 있기때문에 이해하기 쉬울 것
- 사진이 있기 때문에 부하가 잦은 서비스 중 하나
- 사용하게 될 AWS 서비스
- ELB, EB (EC2), S3, SQS, CloudFront, SSM
- 구성 언어 및 프레임워크
- NodeJS V14, Serverless

[img-server.zip](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/4a72eef2-f2de-4282-ba3d-cb01420584f7/img-server.zip)

[main-server.zip](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/fc4bea0e-23f6-4103-8380-ac4f425a8dd7/main-server.zip)  


### 1. 서버(EC2) 자제척으로 처리하기

1. 이미지를 받아서 scale을 0.5로 줄이고 S3에 이미지와 함께 업로드
2. 서버는 썸네일을 만들어 원본과 함께 S3에 저장
3. 다른 사용자가 해당 유저의 썸네일을 부르면 S3에서 해당 파일의 s3의 엔드포인트 가지고 온다

### 2. Elastic Load Balancer를 연결하고 Auto Scaling을 적용하여 부하에 대응하기

1. 이미지 업로드
2. ELB를 통해 적절한 인스턴스로 요청을 보낸 뒤 썸네일을 만들어 S3에 저장
3. 다른 사용자가 해당 유저의 썸네일을 부르면 S3에서 해당 파일을 가지고 와서 주소를 전달

- elb는 보통 ec2에 만들어진다.  
- elastic beanstalk를 사용하면 쉽게 설정할 수 있다.  


### 3 - 1. 람다와 메세지 큐를 통해 비동기로 처리하기
- 이미지를 자주 쓰는 곳에서 대부분 사용하는 방식
- 아래 방식을 사용하면 서버는 이미지와 관련된 작업을 하지 않게된다.  

1. 이미지를 처리하기 위해 서버로 s3 presigned URL 요청
2. 클라이언트는 전달받은 Presigned URL로 이미지 업로드 - 서버를 거치지 않은 이미지 업로드(부하 최소화)
3. 업로드 된 객체의 이름을 서버로 전달
4. 서버는 메세지 큐로 해당 이름을 전달
5. 메세지 큐에 쌓인 정보는 람다를 통해 썸네일을 생성
6. CloudFront를 사용해서 썸네일을 캐싱(Optional)
    - S3에 대한 캐싱만 설정해주면

### 3 - 2. 람다와 S3 트리거를 통해 비동기로 처리하기

1. 이미지를 하기 위해 서버로 s3 presigned URL 요청
2. 전달받은 Presigned URL로 이미지 업로드
3. S3 트리거를 통해 람다를 실행하여 썸네일을 생성
4. CloudFront를 사용해서 썸네일을 캐싱

---

## 질문과 답변
- Q : 선호하는 신입 스페셜리스트 vs 제너럴 리스트  
A : 상세한 업무가 정해져있다면 전문가인게 좋겠지만,  
규모가 작은 기업에서는 다양한 것을 할 줄 아는것이 경쟁력을 가질 수 있다.  
파이썬을 공부하면 써먹을 일이 많다.

- Q : 대용량 데이터 처리 경험 방법  
A : 백엔드의 대용량 처리 - 이미지, 비디오, 파일의 처리 -> 람다  
   데이터 엔지니어의 대용량 처리 - 로그(사용자 로그) -> 하둡, 스파크 등