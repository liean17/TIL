# 트랜잭션 전파 - 활용

### 회원 가입과 로그 예제
- 회원가입시 해당 로그를 DB에 저장하는 경우,  
로그 저장 실패가 회원가입에 영향을 주면 안된다고 할때  
    - **시나리오** service = txOff, repository  = txOn
    - V1 : try catch로 메서드 내부에서 예외를 처리  
    -> 회원은 저장이 되지만 로그는 저장이 되지 않기때문에 데이터 정합성에 문제가 발생한다.
    - **시나리오** service = txOn, repository  = txOff
    - 서비스가 repository메서드를 사용함으로써 하나의 트랜잭션으로 묶이게 된다.
    - 하지만 서비스와 리포지토리가 각각 트랜잭션을 사용하게 하고싶다면? -> 전파

- 전파 사용
    - REQUIRED(기본값)  
    기존 트랜잭션이 있으면 참여한 후 모든 논리 트랜잭션이 커밋되면 커밋되고, 하나의 트랜잭션이라도 롤백되면 물리 트랜잭션이 롤백된다.
    - **복구 REQUIRED**  
    특정 트랜잭션에 예외가 발생해도 전체 트랜잭션은 커밋되도록 해야할 경우  
    V1의 방법을 사용하면 되지않을까? -> '하나의 논리 트랜잭션이 롤백되어도' 전체 트랜잭션이 롤백된다.(setRollbackOnly)  
    - **복구 REQUIRED_NEW**  
    예외가 발생해도 무시하고 트랜잭션을 진행할 메서드에 REQUIRED_NEW 를 설정한다.  
    옵션을 통해서 신규 트랜잭션이 생성되면 그 안에서 예외가 발생해도 새로 생성된 트랜잭션안에서만 롤백이되고 다른 트랜잭션에는 영향을 주지 않게된다.  
    > REQUIRED_NEW 를 사용하게 되면  
    그만큼 데이터베이스 커넥션을 사용하게 되므로 성능에 주의해야한다.  

### 전파 방식 설정에 대하여
- REQUIRED_NEW를 사용하지 않는 '간단한'방법이 있다면 그걸 사용하는게 좋다.
- 예를들어 서비스,리포지토리를 따로 만들어서 다른 트랜잭션에서 사용할 수 있도록 만들면 된다.
- 그러나 구조상 REQUIRED_NEW 를 사용하는게 간단하면 그냥 사용해도된다.
