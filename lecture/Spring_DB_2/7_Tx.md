# 트랜잭션

### JDBC와 JPA의 트랜잭션
- JDBC에서의 트랜잭션과 JPA에서의 트랜잭션코드는 다르다.  
따라서 둘을 함께쓰거나 둘중 하나로 변경하는 경우 트랜잭션 코드도 변경해야한다.  
- 스프링은 이런 문제를 해결하기 위해 트랜잭션 추상화를 제공한다.

### 선언적 트랜잭션 관리 vs 프로그래밍 방식 트랜잭션 관리
- 선언적 트랜잭션 관리 : @Transactional 애노테이션 하나만 선언해서 간편하게 사용
- 프로그래밍 방식 : 직접 코드를 작성

### 트랜잭션 프록시 전체 과정
1. 프록시 호출

    ---
    2. 스프링 컨테이너를 통해 트랜잭션 매니저 획득
    3. DataSource를 통해 커넥션 생성
    4. setAutoCommit(false)
    5. 트랜잭션 동기화 매니저에 커넥션 보관

    ---
6. 실제 서비스 호출
7. 리포지토리에서 트랜잭션 동기화 커넥션 획득

> 흐름
* 트랜잭션메서드를 호출하면 프록시의 메서드가 호출된다.
* 프록시는 트랜잭션 메서드가 트랜잭션을 사용할 수 있는지 확인해보는데 @Transactional 이 붙어있으면 대상이다.
* 즉 트랜잭션을 시작한 다음에 실제 메서드를 호출하는 것이다.

---

### @Transacional 동작 확인법
- TransactionSynchronizationManager.isActualTransactionActive()  
트랜잭션 동작을 확인할 수 있는 메서드(boolean)

### 트랜잭션 적용 위치
- 위치가 구체적일 수록 높은 우선순위를 가진다.  
- AOP가 적용되지않는 경우가 있어서 권장하지 않는 방식이지만 인터페이스에도 어노테이션 적용이 가능하다.
    - 이 경우 다음 순서로 적용된다
    1. 클래스의 메서드
    2. 클래스의 타입
    3. 인터페이스의 메서드
    4. 인터페이스의 타입
