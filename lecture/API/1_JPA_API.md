# API 개발과 최적화

## API 개발 기본

### DTO를 쓰는 이유
- 엔티티를 바로 쓰면 곤란한 이유  
엔티티는 다양한 곳에서 쓰이는데 각 상황마다 다른 검증조건을 엔티티가 모두 가져가는 경우가 발생할 수 있다.  
또 데이터의 이름이 변경될 경우 엔티티 이름을 변경하면 API 전체가 변경된다.  
- 응답측면  
필요없는 정보까지 응답하게 되는 일이 발생한다. 어노테이션을 통해서 json으로 반환되지않게 설정할 수 있지만  
요청마다 다른 응답들에 대해 그러한 설정을 하는것은 쉽지않은 일이다.  
또 LIST형태로 반환하는 경우, 전체에 대한 정보(페이지, 글 갯수)를 함께 전달하기 어렵다.  
따라서 응답값 전체를 DTO로 변환하는 것이 좋다.
### 멱등
- PUT과 PATCH 
PUT은 데이터의 대체고 PATCH는 데이터의 변경이다.  
PUT은 원래 어떤 데이터였건 상관하지않고 수정할 데이터로 대체해버린다.  
따라서 같은 요청을 보내면 계속해서 대체되는데 결국 모두 같은 데이터이기 때문에 반복적인 요청을해도 값이 변화하지않는 멱등성을 가진다.  
PATCH는 원래 데이터의 일부를 변경한다. 그리고 멱등하지 않을 가능성을 가진다.  
단순한 문자, 숫자의 대체와 같은 변경은 계속 같은 요청을 보내도 결과가 같지만  
더하거나 빼는 등 연산이 들어가면 멱등하지 않게된다.  
예를 들어 수정요청마다 count를 1씩 증가하겠다고하면 요청이 반복될수록 count가 증가되어 이전 요청때와 다르게 데이터가 변경된다.  

    하지만 주의해야 할 것은 PUT,GET은 무조건 멱등하고 PATCH는 멱등하지 않은게 아니라는 것이다.  
    해당 요청도 파라미터를 사용해서 데이터를 변화시킬 경우 요청마다 데이터가 변할 수 있고 PATCH역시 연산이 아닌 단순 변경은 멱등한 요청이된다.  
    즉 http메서드를 원래 목적에 사용한다는 전제에서 멱등을 판단해야한다.

### 서비스 메서드
- 쿼리와 커맨드  
서비스에서 Post, Update요청과 함께 해당 객체를 반환하는 형식으로 작성하는 경우  
저장하는 쿼리와 반환하는 커맨드요청이 한번에 이루어진다.  
이렇게한다고 큰 문제가 발생하는 것은 아니지만 영한님은 두가지를 분리하기 위해서  
객체를 반환하지 않거나 id값만 반환한다고 한다.

