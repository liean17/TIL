# 값 타입
- 값 타입은 단순하고 안전하게 다룰 수 있어야 한다.

## 기본값 타입
- JPA의 타입 분류
    - 엔티티  
        - @Entity로 정의
        - 데이터가 변해도 식별자로 지속해서 추적 가능
    - 값 타입
        - int, String 처럼 단순히 값으로 사용
        - 생명주기를 엔티티에 의존한다.
        - 값 타입은 공유하면 안되며 int,double 같은 기본 타입은 불가능하다.  

## 임베디드 타입
- 주로 기본 값 타입을 모아서 만드는 복합 값 타입  
- 재사용이 가능하고 응집도가 높다.
- 임베디드 타입이 null이면 내부 값도 모두 null이된다.  
- 같은 임베디드 타입 값을 여러 엔티티에서 공유하면 값이 변경되어 위험할 수 있다.  
    - 이 경우에는 값을 새로 복사헤서 사용하는 것이 좋다.  
    - 객체의 공유 참조는 컴파일러에서 막을 수 없다.
    - 따라서 생성자로만 값을 설정할 수 있는 불변 객체로 만드는것이 예방책이다.

## 값 타입의 비교  
- 기본형은 값이 동일하면 '=='비교를 사용해도 true가 나온다.
- 값 타입은 equals 메서드를 사용하되, 적절하게 재정의 할 필요가 있다.  

## 값 타입 컬렉션
1. @ElementCollection
    ```java
    @ElementCollection
    @CollectionTable(name = "ADDRESS", joinColumns = 
        @JoinColumn(name = "MEMBER_ID))
    private List<Address> addressHistory = new ArrayList<>();    
    ```
    - 컬렉션을 위한 별도의 테이블이 필요하다.
    - 값 타입 컬렉션은 기본적으로 지연로딩 전략을 사용한다.
    - 값 타입의 수정
        - 가져와서 set을 사용하는게 아니라, 새로 객체를 생성해서 갈아끼워야한다.  
        - 따라서 equals와 hashcode를 잘 구현하면 좋다.
        - 기본형은 기존 데이터를 삭제하고 추가하는 방법뿐이다.  
        - ***그러나*** 식별자가 없어서 추적이 어렵고  
        변경 사항이 발생하면, 주인 엔티티와 연관된 모든 데이터를 삭제하고, 현재 값을 다시 모두 저장하게된다.  
        즉 결과는 제대로 나오지만 추가적인 쿼리가 발생하게되는 것이다.  
        따라서 위 방법은 추천되지않는다.  
    
    - 정말 간단해서 추적할 필요조차 없을때 사용
2. 값 타입 컬렉션 대신 일대다 관계를 고려   
    - 관리, 쿼리최적화에 좋다.  
> **엔티티의 조건**  
식별자가 필요하교, 지속해서 값을 추적,변경해야할때

    