# 프록시
- 조회를 미루는 가짜 객체  
- 조회시에는 영속선 컨텍스트에 초기화 요청을 해서 DB조회 후 실제 엔티티를 생성하게된다.  

### 특징
- 프록시 객체는 처음 사용할 때 한번만 초기화된다.
- 프록시 객체를 초기화 할때, 프록시 객체가 실제 객체로 바뀌는 것이 아니다. 접근 가능하게 될 뿐이다.  
    - 프록시 객체는 원본 엔티티를 상속 받으므로 '=='비교가 아닌 instanceOf를 사용해야한다.  
- 영속성 컨텍스트에 이미 찾는 엔티티가 있으면 프록시가 아닌 실제 엔티티를 반환한다.  

### 프록시 확인
- 프록시 인스턴스의 초기화 여부 확인 : PersistenceUnitUtil.isLoaded(entity)
- 프록시 강제 초기화 : org.hibernate.Hibernate.initialize(entity)
- 강제 호출 : member.getName()

---

## 즉시로딩과 지연로딩

- 지연로딩 : 프록시 객체 조회  
해당 객체를 사용하는 시점에 쿼리가 발생
- 즉시로딩 : 실제 객체 조회  
객체를 한번에 모두 조회 - **N+1 문제 발생**  
예상하지 못한 SQL이 발생할 수 있다.  

### N+1  
JPQL에서 EAGER를 발견하면 객체 데이터가 모두 조회되어야해서 또다른 쿼리가 나간다.  
즉 하나의 쿼리를 예상했는데(1) 여러개의 쿼리가(N) 나가는 것이다.

---

## CASCADE
: 영속성 전이

- 특정 엔티티를 영속 상태로 만들 때 연관된 엔티티도 함께 영속상태로 만들고 싶을 때
    - ALL : 모두 적용
    - PERSIST : 저장할때만
    - REMOVE : 삭제
- 연관관계외는 상관없다
- 객체가 여러 군데와 관계있는 경우에는 주의해야한다.  

### 고아객체
- 부모 엔티티와 연관관계가 끊어진 자식 엔티티  
- orphanRemoval 옵션을 사용하면 자동으로 제거한다.  
- 참조하는 곳이 하나일 때, 특정 엔티티가 개인 소유할 때 사용해야한다.

- Cascade.ALL + orphanRemoval=true  
부모엔티티를 통해서 자식 엔티티 생명주기를 관리할 수 있다.  
DDD의 Aggregate Root 개념을 구현할때 유용하다.