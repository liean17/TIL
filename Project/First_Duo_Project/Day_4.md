# 첫번째 협업 프로젝트
[리포지토리 링크](https://github.com/liean17/first-duo-project)

## 오늘 한 것
- Spring Security 적용  
: 적용은 간단하지만 과정은 복잡한 것이라 생각했는데, 정확했다. 적용은 매우 간단했다.  
1. 스프링 시큐리티를 만어서 접근가능, 불가능한 페이지를 설정하고 로그인 페이지를 입력한다.  입력한 페이지에서 Post요청이 일어나면 스프링 시큐리티는 그것이 로그인 요청으로 받아들인다.  
2. 로그인 요청은 UserDetailsService라는 클래스를 실행함으로써 진행된다. 이것을 상속받아 구현하면 상속받은 그 클래스가 실행된다.  
3. UserDetailsService는 UserDetails라는 타입을 반환해서 로그인을 성공시킨다. 이 UserDetails역시 상속받아 구현함으로써 원하는 정보를 넣을 수 있다.  
4. 나는 PrincipalDetails라는 클래스를 만들어서 반환하게했다. 이것이 세션에 저장되어 로그인에 사용된다.  
5. 세션에 저장되는 과정은 매우 복잡하다. 따라서 세션의 멤버 객체를 사용하는 일도 매우 복잡한데 이를 위해서 **@AuthenticationPrincipal** 이라는 어노테이션이 존재한다. 이것을 사용해서 바로 세션의 객체에 접근할 수 있다.  

- Exception 구현과 ExceptionHandler 생성  
: 이미 존재하는 아이디로 회원가입 하는 경우, 공백으로 회원가입하는 경우, 공백으로 글을 작성하는 경우 예외가 발생한다.  
기본으로 제공되는 오류페이지는 너무 상세해서 서비스이용에는 오히려 좋지않기때문에 간단하게 오류정보를 Body에 전송하는 컨트롤러를 만들고  
각 예외상황에 대한 Exception과 ExceptionHandler를 만들었다.  
하지만 위 예외상황들은 사실 사용자가 예외페이지를 봐야할 정도로 심각한 오류가 아니어서 간단한 메시지로 확인할 수 있게 만들어야 한다.  

- 타임리프에서 권한에 따른 표시 구현  
: 앞서 시큐리티를 위해 Member객체에 Role이라는 변수를 추가했다.  
또한 로그인이 된 사용자에게는 로그인과 회원가입페이지가 보여서는 안되고 접근되어서도 안된다(회원가입은 딱히 상관없는것 같다)  
세션에서 권한 정보를 받아 사용하려했는데 타임리프에서 정말 편하게 권한을 확인하는 방법이 있어서 그걸 사용했다.  
`sec:authorize="!isAuthenticated()"`  
! 문법도 사용가능하고 간단하게 권한 인증 여부를 판단해서 권한이 있으면 해당 div를 보여주지 않는다.  
이뿐만 아니라 hasRole로 지정한 권한이 아닐경우의 여부도 분리 가능하다.
