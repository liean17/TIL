# 첫날

### ERD
- ERD설계부터 제대로 해야겠다는 생각에 ERD Cloud를 사용해서 만들어봤다.
- 완성했다싶었다가도 수정할게 꼭 생겼다. 특히 생각지못한 데이터들이 나중에 생각나는 경우가 많았다.
- ERD 모범사례를 찾아서 흉내내봐야겠다.

### 도메인설계
- 처음에는 나만 사용하기 위해서 회원도 없고 냉장고도 규격이 이미 정해져있기에 Food도메인만 추가하려했다.
- 하지만 왠지 아쉬웠고 회원 별로 냉장고를 구분하는 것을 해보고싶어서 회원을 추가했다.
- Sector 칸
    - 회원을 추가하니 회원별로 분명 냉장고가 다를것이니 냉장고에 대한 엔티티를 추가해야했다.
    - 냉장고 단위로 구분해야하는가 라는 의문이 들었다. 냉장/냉동칸 별로도 나눌 필요가 있기때문이다.
    - 어차피 칸으로 나눈다면 냉장고단위로 구분할 필요는 없을것 같았다.
    - Sector라는 이름으로 칸 엔티티를 추가했다. 네이밍이 맞는지 모르겠다.
- 카테고리
    - 종합 쇼핑몰은 카테고리를 굉장히 다양하게 나눈다.(의류->상의->아우터)
    - 그렇게 하려면 엔티티 안에 본인에 대한 연관관계를 설정하면 된다는 것을 최근에 배워서 적용하고싶었다.
    - 하지만 그럴 필요가 있을까 싶었다. 냉장고에 들어가는 품목들의 카테고리는 다양하겠지만 많은 관리가 필요할 정도로 다양하지는 않을 것 같기때문이었다.
    - 그냥 간편하게 ENUM으로 미리 지정해놓기로했다.

---

## Food
- 핵심 도메인

### entity
[코드 주소](https://github.com/liean17/My-Refrigerator/blob/feat/food/src/main/java/com/toy/refrigerator/food/entity/Food.java)
- ERD 설계와 비교해서 등록일(registration)이 추가되었다. 이미지도 추가해볼까 싶다.
- 카테고리와 음식상태는 내부 enum으로 만들었다.

### dto
[코드 주소](https://github.com/liean17/My-Refrigerator/blob/feat/food/src/main/java/com/toy/refrigerator/food/dto/FoodDto.java)
- enum타입을 입력받는 방법
    - 먼저 String으로 입력받는 것을 생각했다.  
    그리고 서비스에서 enum타입으로 변경할 생각이었는데, 입력단에서 입력하는 문자를 제한할수는 있지만 post맨을 사용해서 지정되지 않은 문자를 입력하면? 파싱이 불가능할 것이다.
    - 그래서 enum에 구분코드(int 타입)을 추가했다. enum 종류가 10개가 있다고하면 숫자가 1보다 작거나 10보다 큰 경우 예외가 발생하도록 할 예정이다.

### test
- entity의 update메서드와 repository의 등록 조회에 대한 테스트 코드를 작성했다.
- @DataJpaTest 어노테이션을 사용하면 jpa환경에서 쉽게 테스트를 할 수 있다.
    - 트랜잭션도 포함되어 편리한데 대신 쿼리가 보이지 않는다.
- entity 수정메서드나 repository 등록 조회 메서드는 솔직히 성공할것이 뻔했다.  
모든 메서드에 유닛테스트를 작성하려고했는데 필요한 테스트와 굳이 필요없는 테스트를 구분할 필요가 있어보인다.  
- 하다보니 평소처럼 성공하는 테스트를 작성했다. 다음부터는 실패를 전제로하는 TDD를 실천해보자.    

---

## 트러블슈팅

### TEST
- @Builder is not supported on non-static nested classes.  
@Builder는 static이 아닌 이너클래스에 사용할 수 없다고 한다.  
나는 static이 아닌 '이너클래스'에 사용할 수 없다고 생각해서 열심히 검색했는데  
알고보니 static이 아닌것이 문제였다. 