# 세번째 멘토링
### 정리
- 메일(라이브러리) :  
보통 서비스를 운영할때는 메일서버를 따로 둔다. 
요새는 구글이나, 아마존에서 메일관련 서비스를 제공해서 사용하기 쉽다.  
단 아마존 메일서비스가 조금 복잡해졌는데 스팸메일이 많아져서였다.  

    - 중요한건 사용할때 이메일을 보낸다는 행위는 바뀌지않는데   
    **다른기능으로 변경해도 큰 수정없이 적용할 수 있도록 추상화를 연습하면 좋다.**  

- 이미지관련  
이미지를 파일시스템으로 보내면 서버에서는 s3로 바로보낸다.  
흔히 하는 방식으로 db에 블롭타입으로 변경해서 바로 사진을 받는 방법이 있다.
    - 온프레미스 방식이면 유리  
    - 클라우드 방식이면 네트워크 트래픽이 과도해진다.  
    s3는 기본적으로 프라이빗이다. 따라서 어떻게 접근할 수 있도록하는가가 핵심이다.  
    signedURL의 경우 매우 중요한 정보를 포함하고있지는 않아서 해당 url을 사용하는 것도 방법이다.  
    - 추가로 sdk를 직접 사용하기보다 서비스에서 sdk에 대한 구현체만 만드는게 좋다.  


- 로드밸런서  
기본적으로 로드밸런서의 역할은 트래픽분산이 맞다  
그렇다면 트래픽이 너무 많을때, 필요한 ec2생성 자동화를 어떻게할것인가?  
성능업,다운 -> 스케일업,다운  
인스턴스늘리기,줄이기 -> 스케일아웃,인  
로드밸런서 -> 로드밸런서의 오토스케일러가 헬스체크를 해서 상태가 더 좋은 애한테 요청을 보낸다.  
혹은 순서를 정해서 하는 방법도 존재한다. 이것이 **로드밸런싱 알고리즘**이다.  
백엔드 개발자라면 로드밸런싱 알고리즘에대해서 많은 이야기를 하게될것이다.  
    - 여기서 조금 더 가면, EC2가 4개 붙어있다고 하자. 동시배포가 된다고 할때 그동안은 요청을 받을 수 없을것인데,  
    여기서도 알고리즘을 적용해서 순서를 설정할 수 있다. -> 무중단배포와 관련된다.  
        - 배포전략(카나리아 배포, 등등 많은 전략이 존재한다.)  
        하나의 인스턴스를 통해 배포를 했다고하자. 오류가 나서 롤백하면 그만큼의 시간이 소요될 것이다.  
        고객의 로스타임 없이 배포할수 있을까를 고민하는 것.  
            - 하나의 예 : 인스턴스 하나를 더 만들어서 로드밸런서가 트래픽을 거기에 조금 트래픽을 보내보고, 일정량 일정시간 보내봤는데 괜찮으면 다른 인스턴스를 죽이고 지금을 사용함. 아니면 반대로한다.  

- 백엔드의 핵심 : 기능구현은 어느정도만 배우면 어떻게든 하고, 잘하는 사람도 많다.  
기능구현보다 중요한건 **어떻게 안정성있게 운영하는가** 

- 로그 정말 중요합니다.   
aws에 클라우드 워치를 사용하면 로깅이 편하다.  
Log4j에 들어가면 로그레벨이있다. 상황에 따라 정해져있는 형식을 써라  
    - 현업 코드리뷰 많이받는내용 -> 로그를 여기에 찍어라, 여기엔 찍지마라   
    로그가 필요한 곳에는 구체적으로 남길수있도록해라  
    예를들어 어떤 메소드가 많이쓰인다면, **어떤곳에서** 메서드가 쓰였는데 오류가났는지 남기는게 좋다.  

- 클라우드 프론트  
이론상 가능하다.  
하지만 이런게 점점 확장되면 클라이언트에서 db바로 붙는거나 다름없음  
서버를 통해서 하는 의미를 찾는게 좋다.  

    - 서버개발자가 하지말아야할것
        - 클라이언트를 믿는것  
        - 클라이언트를 똑똑하게 만드는것
        - 클라이언트가 상태를 가지게 하는것  
            - 동시성문제 : 초창기에서는 저장되있는거확인하는걸로 판단.  
                - s,m 관련해서 렉이있을수있어서 위 방법 별로임  
                - 현대에서는 정보를 캐시에 쌓아놓고 처리하는데 *이게 클라이언트가 상태를 가지고있게되는것*  

- 대용량 트래픽 :  
넷플릭스의 테스트방법 : 몽키테스트(카오스) = 마구잡이로 극한의 상황을 만들어내서 테스트하는것인데, 개인이 하기는 어렵다.    
추천하는 트래픽체험방법 :  
가상트래픽 - 네이버 N그라인더 오픈소스  -> OOM 자주터질거다.  
지금은 수치를 조금만 높여도 뻗을텐데
여기에 대해서 redis캐생, 로드밸런서 등의 방법을 사용해서 썰을 풀정도만 경험해보면 좋다.  
신입에게 대용량 트래픽경험을 기대하지는 않는다.        

- 자투리 조언들(aka.제대로 이해하지못함)
    - m->s 동기화되지 못한채 master가 죽었을때  
    : 수동으로 로그를 찍어가며 동기화시킨다.

    - m->s 승격(***이건 더 알아봐야함 확실치 않음***)  
    : m클러스터 자체에서 승격한다. 슬레이브랑 상관없음  

    - 조금 안다고 이력서에 절대적지마시오.  
    엘라스틱 서치는 로그용이아닙니다. 검색용임  

- 해볼만한 TASK. 
ec2 -> ecs  

---
### 채용사이트 탐방기
- 우대기술 : aws, docker, 대용량 데이터 처리 경험

- 비슷하다 느낀것 : 의외로 코딩테스트를 많이보지않는다.  
기술적 경험에 대해 요구하는 회사가 많았다.(리팩토링, TDD, 새로운 트랜드)  
개똥도 약에쓰인다.  
가고싶은 회사가 없다. 아직 잘 모르겠다.  

- rds이중화를 했는데  
마스터(읽기전용) 슬레이브(그외)
[공식문서](https://docs.aws.amazon.com/ko_kr/AmazonRDS/latest/UserGuide/USER_ReadRepl.html)  

### 질문
- 대용량 트래픽을 경험할 수 있는 방법
- 앱 설계시 필요한 시간. 이번에는 급한마음에 조금 빨리 시작했더니 중간중간 추가로 맞춰야했다.  
- 스스로 실력이 아직 부족하다고 느끼는데 그래도 이력서는 계속 넣어보는게 좋나요  
---